<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Simple Recording Test</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        max-width: 600px;
        margin: 50px auto;
        padding: 20px;
      }
      button {
        padding: 10px 20px;
        margin: 10px;
        font-size: 16px;
        cursor: pointer;
      }
      .success {
        color: green;
      }
      .error {
        color: red;
      }
      #logs {
        background: #f5f5f5;
        padding: 15px;
        border-radius: 5px;
        height: 300px;
        overflow-y: auto;
        font-family: monospace;
        font-size: 12px;
      }
    </style>
  </head>
  <body>
    <h1>Simple Recording Test</h1>

    <button onclick="testBasicRecording()">Test Basic Recording</button>
    <button onclick="testLiveKitRecording()">Test LiveKit Recording</button>
    <button onclick="clearLogs()">Clear Logs</button>

    <h3>Logs:</h3>
    <div id="logs"></div>

    <script type="module">
      import { createLocalAudioTrack } from "https://unpkg.com/livekit-client@2.6.0/dist/livekit-client.esm.mjs";

      function log(message, type = "info") {
        const timestamp = new Date().toLocaleTimeString();
        const logs = document.getElementById("logs");
        const entry = document.createElement("div");
        entry.innerHTML = `<span style="color: #666;">[${timestamp}]</span> ${message}`;
        if (type === "error") entry.style.color = "red";
        if (type === "success") entry.style.color = "green";
        logs.appendChild(entry);
        logs.scrollTop = logs.scrollHeight;
      }

      window.testBasicRecording = async function () {
        log("Testing basic getUserMedia recording...");

        try {
          const stream = await navigator.mediaDevices.getUserMedia({
            audio: {
              echoCancellation: true,
              noiseSuppression: true,
              autoGainControl: true,
            },
          });

          log("‚úÖ Basic recording successful!", "success");
          log(`Audio tracks: ${stream.getAudioTracks().length}`);

          const track = stream.getAudioTracks()[0];
          log(`Track label: ${track.label}`);
          log(`Track enabled: ${track.enabled}`);
          log(`Track ready state: ${track.readyState}`);

          // Stop the stream
          stream.getTracks().forEach((track) => track.stop());
          log("Stream stopped");
        } catch (error) {
          log(
            `‚ùå Basic recording failed: ${error.name} - ${error.message}`,
            "error"
          );

          if (error.name === "NotAllowedError") {
            log(
              "üí° Solution: Allow microphone access in browser settings",
              "info"
            );
          } else if (error.name === "NotFoundError") {
            log("üí° Solution: Connect a microphone to your computer", "info");
          } else if (error.name === "NotReadableError") {
            log("üí° Solution: Close other apps using the microphone", "info");
          }
        }
      };

      window.testLiveKitRecording = async function () {
        log("Testing LiveKit createLocalAudioTrack...");

        try {
          const track = await createLocalAudioTrack({
            echoCancellation: true,
            noiseSuppression: true,
            autoGainControl: true,
            sampleRate: 48000,
            channelCount: 1,
          });

          log("‚úÖ LiveKit recording successful!", "success");
          log(`Track kind: ${track.kind}`);
          log(`Track enabled: ${track.enabled}`);
          log(`Track muted: ${track.isMuted}`);
          log(`Track source: ${track.source}`);

          if (track.mediaStreamTrack) {
            log(`MediaStreamTrack label: ${track.mediaStreamTrack.label}`);
            log(
              `MediaStreamTrack ready state: ${track.mediaStreamTrack.readyState}`
            );
          }

          // Stop the track
          track.stop();
          log("LiveKit track stopped");
        } catch (error) {
          log(
            `‚ùå LiveKit recording failed: ${error.name} - ${error.message}`,
            "error"
          );
          log(`Error stack: ${error.stack}`, "error");

          if (error.message.includes("permission")) {
            log(
              "üí° Solution: Allow microphone access and refresh page",
              "info"
            );
          } else if (error.message.includes("not found")) {
            log("üí° Solution: Check microphone connection", "info");
          }
        }
      };

      window.clearLogs = function () {
        document.getElementById("logs").innerHTML = "";
      };

      // Initial log
      log("Simple recording test page loaded");
      log("Click buttons above to test different recording methods");
    </script>
  </body>
</html>
