<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Microphone Test</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        max-width: 600px;
        margin: 50px auto;
        padding: 20px;
      }
      button {
        padding: 10px 20px;
        margin: 10px;
        font-size: 16px;
        cursor: pointer;
      }
      .success {
        color: green;
      }
      .error {
        color: red;
      }
      .info {
        color: blue;
      }
      #status {
        margin: 20px 0;
        padding: 10px;
        border-radius: 5px;
      }
      #logs {
        background: #f5f5f5;
        padding: 15px;
        border-radius: 5px;
        height: 200px;
        overflow-y: auto;
        font-family: monospace;
        font-size: 12px;
      }
    </style>
  </head>
  <body>
    <h1>Microphone Test</h1>
    <p>This will test if your microphone is working properly.</p>

    <button onclick="testMicrophone()">Test Microphone</button>
    <button onclick="clearLogs()">Clear Logs</button>

    <div id="status">Click "Test Microphone" to start</div>

    <h3>Logs:</h3>
    <div id="logs"></div>

    <script>
      function log(message, type = "info") {
        const timestamp = new Date().toLocaleTimeString();
        const logs = document.getElementById("logs");
        const entry = document.createElement("div");
        entry.innerHTML = `<span style="color: #666;">[${timestamp}]</span> ${message}`;
        if (type === "error") entry.style.color = "red";
        if (type === "success") entry.style.color = "green";
        logs.appendChild(entry);
        logs.scrollTop = logs.scrollHeight;
      }

      function updateStatus(message, type = "info") {
        const status = document.getElementById("status");
        status.textContent = message;
        status.className = type;
      }

      async function testMicrophone() {
        log("Starting microphone test...");
        updateStatus("Testing microphone...", "info");

        try {
          // Check if getUserMedia is supported
          if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
            throw new Error("getUserMedia is not supported in this browser");
          }

          log("Requesting microphone access...");

          // Request microphone permission
          const stream = await navigator.mediaDevices.getUserMedia({
            audio: {
              echoCancellation: true,
              noiseSuppression: true,
              autoGainControl: true,
            },
          });

          log("‚úÖ Microphone access granted!", "success");
          updateStatus("‚úÖ Microphone is working!", "success");

          // Test audio track
          const audioTracks = stream.getAudioTracks();
          log(`Found ${audioTracks.length} audio track(s)`);

          if (audioTracks.length > 0) {
            const track = audioTracks[0];
            log(`Audio track label: ${track.label}`);
            log(`Audio track enabled: ${track.enabled}`);
            log(`Audio track ready state: ${track.readyState}`);
          }

          // Test audio context
          try {
            const audioContext = new (window.AudioContext ||
              window.webkitAudioContext)();
            log(`Audio context state: ${audioContext.state}`);
            audioContext.close();
          } catch (audioError) {
            log(`Audio context error: ${audioError.message}`, "error");
          }

          // Clean up
          stream.getTracks().forEach((track) => {
            track.stop();
            log(`Stopped track: ${track.label}`);
          });

          log("‚úÖ Microphone test completed successfully!", "success");
        } catch (error) {
          log(`‚ùå Microphone test failed: ${error.message}`, "error");
          updateStatus(`‚ùå Microphone test failed: ${error.message}`, "error");

          // Provide specific error guidance
          if (error.name === "NotAllowedError") {
            log(
              "üí° Solution: Please allow microphone access in your browser",
              "info"
            );
          } else if (error.name === "NotFoundError") {
            log(
              "üí° Solution: Please connect a microphone to your computer",
              "info"
            );
          } else if (error.name === "NotReadableError") {
            log(
              "üí° Solution: Close other apps that might be using your microphone",
              "info"
            );
          }
        }
      }

      function clearLogs() {
        document.getElementById("logs").innerHTML = "";
      }

      // Initial log
      log("Microphone test page loaded");
    </script>
  </body>
</html>
